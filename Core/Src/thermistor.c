#include "main.h"
#include "thermistor.h"


int NTC_table[257] = {
  3981, 3295, 2609, 2274, 2060, 1906, 1786,
  1690, 1609, 1540, 1480, 1427, 1379, 1336,
  1297, 1261, 1228, 1197, 1168, 1141, 1116,
  1092, 1069, 1048, 1028, 1008, 990, 972, 955,
  939, 923, 908, 893, 879, 865, 852, 839, 827,
  815, 803, 792, 781, 770, 759, 749, 739, 729,
  720, 710, 701, 692, 683, 674, 666, 658, 650,
  641, 634, 626, 618, 611, 603, 596, 589, 582,
  575, 568, 561, 555, 548, 542, 535, 529, 523,
  517, 510, 504, 498, 493, 487, 481, 475, 470,
  464, 458, 453, 448, 442, 437, 432, 426, 421,
  416, 411, 406, 401, 396, 391, 386, 381, 376,
  371, 366, 362, 357, 352, 347, 343, 338, 334,
  329, 324, 320, 315, 311, 306, 302, 298, 293,
  289, 284, 280, 276, 271, 267, 263, 259, 254,
  250, 246, 242, 237, 233, 229, 225, 221, 216,
  212, 208, 204, 200, 196, 191, 187, 183, 179,
  175, 171, 167, 163, 159, 154, 150, 146, 142,
  138, 134, 130, 126, 121, 117, 113, 109, 105,
  101, 97, 92, 88, 84, 80, 76, 71, 67, 63,
  59, 54, 50, 46, 41, 37, 33, 28, 24, 19, 15,
  11, 6, 2, -3, -8, -12, -17, -21, -26, -31,
  -36, -40, -45, -50, -55, -60, -65, -70, -75,
  -80, -86, -91, -96, -102, -107, -113, -118,
  -124, -130, -135, -141, -147, -153, -160,
  -166, -172, -179, -186, -192, -199, -206,
  -214, -221, -229, -236, -244, -253, -261,
  -270, -279, -288, -298, -308, -318, -329,
  -340, -352, -365, -378, -392, -408, -424,
  -442, -461, -482, -507, -534, -567, -608,
  -663, -751, -839
};


int NTC_ADC2Temperature(unsigned int adc_value){

  int p1,p2;

  p1 = NTC_table[ (adc_value >> 4)  ];
  p2 = NTC_table[ (adc_value >> 4)+1];

  /* Interpolate between both points. */
  return p1 - ( (p1-p2) * (adc_value & 0x000F) ) / 16;
};
